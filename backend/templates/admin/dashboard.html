{% extends "admin/base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h1>Word Analysis Dashboard</h1>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Word</th>
            <th>Part of Speech</th>
            <th>Language</th>
            <th>JSON Data</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for word in words %}
        <tr>
            <td>{{ word.id }}</td>
            <td>{{ word.word }}</td>
            <td>{{ word.part_of_speech }}</td>
            <td>{{ word.language }}</td>
            <td>
                <pre id="json-data-{{ word.id }}">{{ word.data|tojson(indent=2) }}</pre>
            </td>
            <td>
                <a href="{{ url_for('admin.edit_word', word_id=word.id) }}">Edit</a>
                <form action="{{ url_for('admin.delete_word', word_id=word.id) }}" method="post" style="display:inline;">
                    <input type="submit" value="Delete" onclick="return confirm('Are you sure?');">
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Function to decode Unicode escape sequences
    function decodeUnicode(str) {
        return str.replace(/\\u([0-9a-fA-F]{4})/g, function(match, group) {
            return String.fromCharCode(parseInt(group, 16));
        });
    }

    // Find all pre elements with JSON data
    document.querySelectorAll('pre[id^="json-data-"]').forEach(function(pre) {
        try {
            // Parse the JSON
            let jsonData = JSON.parse(pre.textContent);
            
            // Recursively decode Unicode in the entire JSON object
            function decodeUnicodeInObject(obj) {
                if (typeof obj === 'string') {
                    return decodeUnicode(obj);
                }
                if (Array.isArray(obj)) {
                    return obj.map(decodeUnicodeInObject);
                }
                if (obj !== null && typeof obj === 'object') {
                    let newObj = {};
                    for (let key in obj) {
                        newObj[key] = decodeUnicodeInObject(obj[key]);
                    }
                    return newObj;
                }
                return obj;
            }

            // Decode and re-stringify with proper Unicode characters
            let decodedJsonData = decodeUnicodeInObject(jsonData);
            pre.textContent = JSON.stringify(decodedJsonData, null, 2);
        } catch (e) {
            console.error('Error decoding JSON:', e);
        }
    });
});
</script>
{% endblock %}
